#!/usr/bin/env php
<?php

if (!isset($argv[1])) {
    die("Usage: ./bin/compile <page>\n");
}

$page = $argv[1];
$template = 'default.phtml';

$dir = 'site/'.dirname($page);

if (!is_dir($dir) && !mkdir($dir, 0777, true)) {
    die("Failed to create directory $dir\n");
}

$pagePath = "pages/{$page}";

ob_start();
include $pagePath;
$content = ob_get_clean();

$templatePath = "templates/{$template}";

ob_start();
include $templatePath;
$fullPage = ob_get_clean();

[
    'dirname' => $dirname,
    'filename' => $filename,
] = pathinfo($page);

$targetPath = "site/$dirname/$filename";
file_put_contents($targetPath, $fullPage);